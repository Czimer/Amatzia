@using Amatzia.Models

@model IEnumerable<Amatzia.Models.User>

@{
    ViewBag.Title = "Users";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Users</h2>
<br />

@using (Html.BeginForm("Search", "User", FormMethod.Get))
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true, "", new { @class = "text-danger" })

    var searchUser = new Amatzia.Models.User();
    bool UserIsManager = bool.Parse(TempData["IsManager"].ToString());

    <div class="searchDiv">
        @Html.Label("FirstName", htmlAttributes: new { @class = "control-label col-md-3" })
        <span class="col-md-4">
            @Html.Editor("FirstName", new { htmlAttributes = new { @class = "form-control" } })
        </span>
    </div>
    <div class="searchDiv">
        @Html.Label("LastName", htmlAttributes: new { @class = "control-label col-md-3" })
        <span class="col-md-4">
            @Html.Editor("LastName", new { htmlAttributes = new { @class = "form-control" } })
        </span>
    </div>
    if (UserIsManager)
    {
        <div class="searchDiv">
            @Html.Label("DateOfBirth", htmlAttributes: new { @class = "control-label col-md-3" })
            <span class="col-md-4">
                @Html.Editor("DateOfBirth", new { htmlAttributes = new { @class = "form-control" } })
            </span>
        </div>
    }
    if (UserIsManager)
    {
        <div class="searchDiv">
            @Html.LabelFor(user => searchUser.Gender, htmlAttributes: new { @class = "control-label col-md-3" })
            <span class="col-md-4">
                @Html.DropDownList("Gender", new SelectList(Enum.GetValues(typeof(Gender))), new { htmlAttributes = new { @class = "form-control" } })
            </span>
        </div>
    }
    if (UserIsManager)
    {
        <div class="searchDiv">
            @Html.LabelFor(user => searchUser.Country, htmlAttributes: new { @class = "control-label col-md-3" })
            <span class="col-md-4">
                @Html.DropDownList("Country", new SelectList((List<string>)TempData["Countries"]), new { htmlAttributes = new { @class = "form-control" } })
            </span>
        </div>
    }
    <div class="searchDiv">
        <input class="btn btn-default" type="submit" name="Search" value="חפש" />
    </div>

    <table id="modelTable" class="table">
        <tr>
            <th>@Html.DisplayNameFor(user => user.FirstName)</th>
            <th>@Html.DisplayNameFor(user => user.LastName)</th>
            <th>@Html.DisplayNameFor(user => user.Gender)</th>
            <th>@Html.DisplayNameFor(user => user.DateOfBirth)</th>
            <th>@Html.DisplayNameFor(user => user.Country)</th>
            <th></th>
        </tr>

        @if (Model.Count() > 0)
        {
            foreach (var user in Model)
            {
                <tr>
                    <td>
                        @Html.DisplayFor(currUser => user.FirstName)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => user.LastName)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => user.Gender)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => user.DateOfBirth)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => user.Country)
                    </td>
                    <td>
                        @Html.ActionLink("| ", "Details", new { UserId = user.UserId }, new { @class = "glyphicon glyphicon-info-sign" })

                        @if (UserIsManager)
                        {
                            @Html.ActionLink("| ", "Edit", new { UserId = user.UserId }, new { @class = "glyphicon glyphicon-edit" });
                            @Html.ActionLink(" ", "Delete", new { UserId = user.UserId }, new { @class = "glyphicon glyphicon-trash" });
                        }

                    </td>
                </tr>
            }
        }
    </table>

    <script src='@Url.Content("~/Scripts/Countries/Countries.js")' type="text/javascript"></script>
}
